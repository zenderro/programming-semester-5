# Добрый день, группа 312!
<style type="text/css">
div.sourceCode {
  font-size: 1.2em;
}
section.slide > pre {
  font-size: 0.8em;
}
section.slide > p {
  text-align: left;
  text-indent: 2em;
}
.reveal div.owl {
  background-size: 65%;
}
.owl p, .owl h1 {

  -webkit-text-stroke-width: 1.1pt;
-webkit-text-stroke-color: #fff;
  font-weight: 700;
}

.green-box {
  background-color: #afa;
}
.red-box {
  background-color: #faa;
}
.yellow-box {
  background-color: #ff0;
}

</style>

## План
- симметричные и положительно определённые матрицы
- метод Холецкого
- QR-разложение для обращения матрицы
- метод вращений
- метод отражений
- обращение матрицы

Материалы к занятиям: https://zenderro.github.io/programming-semester-5/

email: [andrey.zenzinov@math.msu.ru](mailto:andrey.zenzinov@math.msu.ru)

# Симметричные матрицы

— матрицы, элементы которых симметричны относительно главной диагонали:
$$a_{ij} = a_{ji}$$

$$
\begin{pmatrix}
a_{11} & \bbox[#0ff, 3pt]{a_{12}} & \bbox[#0df, 3pt]{a_{13}} & \bbox[#0af, 3pt]{a_{14}} \\
\bbox[#0ff, 3pt]{a_{21}} & a_{22} & \bbox[#0ff, 3pt]{a_{23}} & \bbox[#0df, 3pt]{a_{24}} \\
\bbox[#0df, 3pt]{a_{31}} & \bbox[#0ff, 3pt]{a_{32}} & a_{33} & \bbox[#0ff, 3pt]{a_{34}} \\
\bbox[#0af, 3pt]{a_{41}} & \bbox[#0df, 3pt]{a_{42}} & \bbox[#0ff, 3pt]{a_{43}} & a_{44}
\end{pmatrix}
$$

# Симметричные матрицы

Для них достаточно хранить верхний треугольник:

$$
\begin{pmatrix}
a_{11} & \bbox[#0ff, 3pt]{a_{12}} & \bbox[#0df, 3pt]{a_{13}} & \bbox[#0af, 3pt]{a_{14}} \\
& a_{22} & \bbox[#0ff, 3pt]{a_{23}} & \bbox[#0df, 3pt]{a_{24}} \\
&  & a_{33} & \bbox[#0ff, 3pt]{a_{34}} \\
& & & a_{44}
\end{pmatrix}
$$

# Положительно определённые матрицы
— матрицы $A$, для которых $(Ax, x) > 0$ для любых векторов $x ∈ ℝ^n$.

Положительно определённые матрицы невырождены и имеют ненулевые главные
миноры.

Симметричная (самосопряжённая) матрица положительно определена ⇔ все её
собственные значения веществены и положительны.

# Метод Холецкого
Пусть $A$ — симметрична с ненулевыми главными минорами. 

Тогда: $$A = R^T · D · R$$,
где $R$ — невырожденная верхнетреугольная, а $D = diag(±1, ±1, ... , ±1)$.

Для комплексного общего случая (самосопряжённой матрицы с ненулевыми главными
минорами) получаем из $LU$-разложения $A = R^\ast · D · R$ , а в частном случае
вещественной $A$ получаем формулу выше. Для вещественной положительно
определённой к тому же $D = I$ .

Один из индикаторов для пошаговой проверки реализации: значения $d_{i,i}$ для
положительно определённой матрицы должны быть единичными. Можно начать
тестировать с диагональных матриц.

# Метод Холецкого
## Реализация (вещественный случай)
Вычисляем значения элементов построчно, сначала — элемент $d_{ii}$ диагональной
матрицы $D$ , потом — диагональный элемент $r_{ii}$ верхнетреугольной матрицы $R$, затем
— оставшиеся элементы $r_{i,i+1 ... n}$ матрицы $R$. 

Для вычисления каждого элемента нужно
запоминать только текущий элемент матрицы $A$ , поэтому можно сразу
перезаписывать элементы матрицы $A$ вновь найденными элементами матрицы $R$.

- $d_{ii} = sign(a_{ii} - \sum_{k=1}^{i-1}r^2_{ki}\cdot d_{kk})$ - хранится в отдельном векторе
- $r_{ii} = \sqrt{|a_{ii}-\sum_{k=1}^{i-1}r^2_{ki}\cdot d_{kk}|}$ - корень из модуля того же выражения, знак которого определяет $d_{ii}$
- $r_{ij} = \frac{a_{ij}-\sum_{k=1}^{i-1}r_{ki}\cdot d_{kk} \cdot r_{kj}}{r_{ii}\cdot d_{ii}}$, при этом $j = (i+1) ... n$

# Метод Холецкого
## Решение линейной системы

$$ R^T\cdot D \cdot R \cdot x = b  $$

1. $R^T \cdot z = b$ - система с нижнетреугольной матрицей, решается обратным ходом
метода Гаусса
2. $D \cdot y = z$ - просто меняем знаки элементов
3. $R \cdot x = y$ - система с верхнетреугольной матрицей, решается обратным ходом
метода Гаусса

**Обращение матрицы** — аналогично. Все шаги выполняются одновременно с n
правыми частями.

# Метод Холецкого
## Хранение матрицы в памяти

На месте матрицы $A$:

$$
\begin{pmatrix}
\bbox[#afa, 3pt]{r_{11}} & \bbox[#afa, 3pt]{r_{12}} & \bbox[#afa, 3pt]{r_{13}} & ... & \bbox[#afa, 3pt]{r_{1n}} \\
a_{12} & \bbox[#afa, 3pt]{r_{22}} & \bbox[#afa, 3pt]{r_{23}} & ... & \bbox[#afa, 3pt]{r_{2n}} \\
a_{13} & a_{23} & \bbox[#afa, 3pt]{r_{33}} & ... & \bbox[#afa, 3pt]{r_{3n}} \\
... & ... & ... & ... & ... \\
a_{1n} & a_{2n} & a_{3n} & ... & \bbox[#afa, 3pt]{r_{nn}}
\end{pmatrix}
$$

$D$ хранится в отдельном векторе.

# QR-разложение

**Теорема о QR-разложении**. Всякая невырожденная матрица $A$ может быть представлена в виде $A = QR$, где матрица $Q$ - ортогональная, а $R$ - верхнетреугольная с положительными элементами на главной диагонали. Это разложение единственно.

# Метод вращений

## Матрица вращений

$$ T_{ij}(\varphi) = 
\begin{pmatrix}
1 & & & & & & & & & & \\
& \ddots & & & & & & & & & \\
& & 1 & & & & & & & & \\
& & & cos \varphi &&  & & -sin\varphi & & & \\
& & & & 1 & & & & & & \\
& & & & & \ddots & & & & & \\
& & & & & & 1 & & & & \\
& & & sin\varphi & & & & cos\varphi & & & \\
& & & & & & & & 1 & & \\
& & & & & & & & & \ddots & \\
& & & & & & & & & & 1 
\end{pmatrix}
$$

# Метод вращений

Умножение слева на $T_{ij}(\varphi)$ проще рассматривать как операцию с параметрами:
$$T(i,j,\varphi)\cdot x = y$$, где:
- $y_k = x_k, k\ne i,j$;
- $y_i = x_i cos\varphi - x_j sin\varphi$;
- $y_j = x_i sin\varphi + x_j cos\varphi$.

Любой двумерный вектор $(x, y)$ можно повернуть так, что его вторая координата обнулится.

$$cos\varphi=\frac{x}{\sqrt{x^2+y^2}}, sin\varphi=\frac{-y}{\sqrt{x^2+y^2}}$$.

В результате такого поворота: $(x, y) ↦ (\sqrt{x^2+y^2}, 0) = (‖(x, y)‖, 0)$

При реализации можно использовать функцию `hypot`.

# Алгоритм метода вращений

$$
\begin{pmatrix}
‖a_1‖ & c_{12} & \cdots & c_{1,n-1} & c_{1,n} \\
& a^{(1)}_{22} & \cdots & a^{(1)}_{2,n-1} & a^{(1)}_{2,n} \\
& \vdots & \vdots & \vdots & \vdots \\
& a^{(1)}_{n-1,2} & \cdots & a^{(1)}_{n-1,n-1} & a^{(1)}_{n-1,n} \\
& a^{(1)}_{n,2} & \cdots & a^{(1)}_{n,n-1} & a^{(1)}_{n,n}
\end{pmatrix}
$$

- Для каждой строки $i=1 ... n$
- Для каждой строки $k=i+1 ... n$:
    - Найти угол $\varphi_{ij}$, обнуляющий вторую компоненту $(a_{ii}, a_{ki})$
    - Повернуть каждый столбец $j=i ... n$ на этот угол

Левая и верхняя части матрицы (столбцы $1...i − 1$ и строки $1...i − 1$ ) на последующих
шагах $i ... n$ не модифицируются.

# Метод отражений
## Матрица отражений

Идея: Отразить вектор относительно гиперплоскости $⟨x⟩^⟂$, где $‖x‖ = 1$.

Матрица отражения: $U(x)=I-2xx^\ast$, $‖x‖ = 1$.

Проще рассматривать умножение слева на $U(x)$ как операцию: $$U(x) · y = y − 2x(y, x)$$

Отражение может быть задано для подпространства:

$$
U_k=
\begin{pmatrix}
I_{k-1}&0\\
0& U(x)
\end{pmatrix}
$$

# Метод отражений
## Приведение матрицы к треугольному виду

Любой вектор $y$ можно отразить относительно гиперплоскости $⟨x⟩^⟂$ так, что все его координаты кроме первой обнулятся: $$x=\pm\frac{y-‖y‖e_1}{‖y-‖y‖e_1‖}$$

Таким образом, $y ↦‖y‖ · e1$

Чтобы найти вектор отражения вычисляются:
- «преднорма» y без первой компоненты: $s = Σ|y_i|^2$;
- $‖y‖ = \sqrt{|y_1|^2 + s}$;
- первая координата $x_1' = y_1 - ‖y‖$ и норма $‖x'‖ = \sqrt{|x_1'|^2+s}$
- нормированный вектор $x=x'/‖x'‖$.

# Алгоритм метода отражений

$$
\begin{pmatrix}
‖a_1‖ & c_{12} & \cdots & c_{1,n-1} & c_{1,n} \\
& a^{(1)}_{22} & \cdots & a^{(1)}_{2,n-1} & a^{(1)}_{2,n} \\
& \vdots & \vdots & \vdots & \vdots \\
& a^{(1)}_{n-1,2} & \cdots & a^{(1)}_{n-1,n-1} & a^{(1)}_{n-1,n} \\
& a^{(1)}_{n,2} & \cdots & a^{(1)}_{n,n-1} & a^{(1)}_{n,n}
\end{pmatrix}
$$

- Для каждого столбца $j=1...n$:
    - Найти вектор отражения $x_j$ размерности $n-j+1$;
    - Отразить столбцы $j...n$ относительно этого вектора.

# QR-разложение методом отражений

Предлагается следующий способ хранения:

$$v = (r_{11}, r_{22}, r_{33}, \dots , r_{nn})$$

$$\begin{pmatrix}
x_{11} & r_{12} & \cdots & r_{1n} \\
x_{12} & \ddots & & \vdots \\
\vdots & \vdots & \ddots & \vdots \\
x_{1n} & x_{2n} & \cdots & x_{nn}
\end{pmatrix}$$

# Обращение матрицы

1. С помощью присоединённой матрицы:

    $$(A|I)↦(I|A^{-1})$$
    
    Как и в случае решения линейной системы, аналогичные преобразования
    выполняются и над правой частью.
    
2. С помощью $QR$-разложения.

    $$(QR)^{-1}=R^{-1}\cdot Q^T$$

    $$B\cdot Q^T = (Q\cdot B^T)^T$$

    $$Q = Q_k\dots Q_1 $$

